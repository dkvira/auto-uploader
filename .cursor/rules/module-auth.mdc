---
description: 
globs: usso/app/apps/auth/*.py
alwaysApply: false
---

## ğŸ” Purpose
Defines conventions for handling authentication entry points including login flows, MFA, QR login, and passkey support.

## ğŸ“ Scope
This module is responsible for initiating and validating authentication attempts. It does not manage identity or access control logic directly.

## ğŸ“¦ Module Conventions
- `models.py` â€” Temporary login state, MFA challenge metadata.
- `schemas.py` â€” Pydantic schemas for login, challenge requests, and verification.
- `routes.py` â€” Endpoints like `/login`, `/qr`, `/passkey`, `/request-otp`, etc.
- `services.py` â€” Stateless logic for credential validation, OTP, and MFA verification.

## ğŸ” Security Boundaries
- This module should never issue JWTs or manipulate access tokens directly. It must delegate to the `token` service.
- All flows must support logging, rate limiting, and fraud detection hooks.

## âœ… Best Practices
- Normalize login inputs (emails, phone numbers) before processing.
- Separate endpoints by login method for clarity and easier rate control.
- Design for future-proof extensibility: magic link, biometric, federated ID.

## ğŸ§ª Testing Expectations
- End-to-end tests for OTP expiry, MFA step-up, and QR-based pairing.
- Negative testing for wrong credentials, expired tokens, and tampering.

## ğŸ” Integration Points
- Relies on `identity.user`, `identity.session`, and `identity.token`.
- May use external services for OTP delivery (e.g., SMS, email providers).
