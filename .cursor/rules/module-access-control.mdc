---
description: 
globs: usso/app/apps/access_control/*.py
alwaysApply: false
---

## ğŸ” Purpose
Defines conventions for managing roles, permissions, and workspace scoping in the `apps/access_control/` layer.

## ğŸ“ Folder Structure
- `role/` â€” Handles role definitions, hierarchies, and role-to-user bindings.
- `workspace/` â€” Manages per-tenant workspaces with isolated access policies.

## ğŸ“¦ Module Conventions
Each submodule must contain:
- `models.py` â€” Permission-related document models.
- `schemas.py` â€” Pydantic request/response schemas.
- `routes.py` â€” FastAPI routers for admin/config APIs.
- `services.py` â€” Business logic for role resolution and workspace queries.

## ğŸ§­ Design Principles
- Permissions must be encoded in role bindings and validated at route level.
- Token payloads must only include roles and resolved scopes (no workspace logic embedded).
- Workspace isolation must be enforced using `workspace_id` extracted from token claims.

## âœ… Best Practices
- Role names should be globally unique within a tenant.
- Use consistent prefixes for workspace-scoped objects (`ws_`, `role:`).
- Validate workspace membership and role access before granting scope.

## ğŸ§ª Testing Expectations
- Simulate role-based access via mocked tokens.
- Write unit tests for workspace switching and access enforcement edge cases.

## ğŸ” Security Considerations
- Prevent privilege escalation by restricting who can create/edit roles.
- Do not hardcode any role/permission logic; make all behavior policy-driven.
